(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{1029:function(e,t,r){"use strict";var n=r(0),o=(r(575),r(14),r(1151)),c=r.n(o),d={name:"VideoStream",props:{src:{type:String},muted:{type:[Boolean,String],default:!1},play:{type:Boolean}},data:function(){return{hls:void 0}},computed:{player:function(){return this.$refs.player}},watch:{play:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!e){r.next=5;break}return r.next=3,t.player.play();case 3:r.next=6;break;case 5:t.player.pause();case 6:case"end":return r.stop()}}),r)})))()}},mounted:function(){this.src&&(this.src.endsWith(".m3u8")?this.HLSInitialize(this.player):this.MP4Initialize(this.player)),this.setPlayerListeners(this.player),this.$emit("on-player-loaded",this.player)},beforeDestroy:function(){var e;null===(e=this.hls)||void 0===e||e.destroy(),this.removePlayerListers(this.player)},methods:{HLSInitialize:function(e){var t=this;try{c.a.isSupported()?(this.hls=new c.a({startLevel:3}),this.hls.loadSource(this.src),this.hls.attachMedia(e),this.hls.on(c.a.Events.ERROR,(function(e,data){var r;"networkError"===data.type&&404===(null===(r=data.response)||void 0===r?void 0:r.code)&&(t.getStreamFailureCount<3?t.getStreamFailureCount++:t.isShowRetry=!0)}))):e.canPlayType("application/vnd.apple.mpegurl")&&(e.src=this.src),e.play()}catch(e){this.$handleError(e)}},MP4Initialize:function(e){e.src=this.src,e.play()},setPlayerListeners:function(e){e.addEventListener("canplay",this.emitCanPlayListener),e.addEventListener("play",this.emitPlayListener),e.addEventListener("ended",this.emitEndedListener),e.addEventListener("pause",this.emitPauseListener)},removePlayerListers:function(e){e.removeEventListener("canplay",this.emitCanPlayListener),e.removeEventListener("play",this.emitPlayListener),e.removeEventListener("ended",this.emitEndedListener),e.removeEventListener("pause",this.emitPauseListener)},emitCanPlayListener:function(){this.$emit("on-canplay")},emitPlayListener:function(){this.$emit("on-play")},emitEndedListener:function(){this.$emit("on-ended")},emitPauseListener:function(){this.$emit("on-pause")}}},l=r(2),component=Object(l.a)(d,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("video",{ref:"player",domProps:{muted:e.muted}},[e._t("default",(function(){return[e._v("مرورگر شما از ویدیو پشتیبانی نمی‌کند.")]}))],2)}),[],!1,null,null,null);t.a=component.exports},1153:function(e,t,r){e.exports={}},1154:function(e,t,r){e.exports={}},1155:function(e,t,r){e.exports={}},1224:function(e,t,r){"use strict";r(1153)},1225:function(e,t,r){"use strict";r(1154)},1226:function(e,t,r){"use strict";r(1155)},1249:function(e,t,r){"use strict";r(20);var n=r(0),o=(r(14),r(43),r(277),r(8),r(3)),c=r(340),d=r(359),l=r(1029),h=r(77),v=r(339),f={name:"DiscoveryMetroCard",components:{Bookmark:d.a,ShareModal:c.a,BsDropdown:o.BsDropdown,VideoStream:l.a},props:{id:{type:[Number,String],required:!0},name:{type:String,required:!0},link:{type:String,default:""},photo:{type:Object,required:!0},price:{type:[Number,String],required:!0},video:{type:Object,required:!0},vendor:{type:Object,required:!0},pageId:{type:String,default:void 0},listingIds:{type:Array,default:function(){return[]}}},data:function(){return{play:!1,isPlayed:!1,player:void 0,isShareModalOpen:!1}},computed:{convertedPrice:function(){return Object(h.numberSeparator)(Object(h.rialToToman)(this.price))},productShareObject:function(){return{id:this.id,name:this.name,vendor:this.vendor}}},mounted:function(){this.player&&this.pauseVideoOnScroll()},methods:{productShareableData:v.b,openShareModal:function(){this.isShareModalOpen=!0},closeShareModal:function(){this.isShareModalOpen=!1},showReportModal:function(){PubSub.publish(this.events.SHOW_REPORT_MODAL,{source:"DISCOVERY",entityType:"PRODUCT",entityId:this.id,reason:this.enums.report.PRODUCT})},onMetroCardClick:function(){this.sendClickLog(),this.goToDiscoveryInterface(this.link)},goToDiscoveryInterface:function(link){this.$router.push(link)},sendClickLog:function(){"discovery"===this.$route.name?this.sendProductClickLog():this.sendProductSimilarClickLog()},sendProductClickLog:function(){this.$publishEvent((function(e){return e.discovery_click}))({price:this.price,product_id:this.id,product_name:this.name,discovery_page_id:this.pageId,vendor_id:this.vendor.id,vendor_name:this.vendor.name,vendor_identifier:this.vendor.identifier,has_video:!!Object.keys(this.video).length})},sendProductSimilarClickLog:function(){this.$publishEvent((function(e){return e.discovery_similar_click}))({main_product:{product_id:this.$route.params.id||0},product_id:this.id,product_name:this.name,has_video:!!Object.keys(this.video).length,price:this.price,vendor_id:this.vendor.id,vendor_name:this.vendor.name,vendor_identifier:this.vendor.identifier})},getPlayerElement:function(e){this.player=e},togglePlayer:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.play){t.next=5;break}e.player.pause(),e.isPlayed=!1,t.next=8;break;case 5:return t.next=7,e.player.play();case 7:e.isPlayed=!0;case 8:case"end":return t.stop()}}),t)})))()},pauseVideoOnScroll:function(){var e=this,t=new IntersectionObserver(function(){var t=Object(n.a)(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r[0].intersectionRatio>0)){t.next=3;break}return t.next=3,e.togglePlayer();case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),{threshold:.1});t.observe(this.player)}}},y=f,m=(r(1224),r(2)),component=Object(m.a)(y,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"discovery-product-card"},[r("div",{staticClass:"discovery-product-card__actions-wrapper"},[r("a",{staticClass:"discovery-product-card__media-box",attrs:{href:e.link,"data-from":"discovery"},on:{click:function(t){return t.preventDefault(),e.onMetroCardClick.apply(null,arguments)}}},[e.video.LARGE?r("VideoStream",{staticClass:"discovery-product-card__media",attrs:{loop:"",muted:"",autoplay:"",src:e.video.HLS},on:{"on-player-loaded":e.getPlayerElement}},[r("source",{attrs:{src:e.video.LARGE,type:"video/mp4"}}),e._v("\n        مرورگر شما از ویدیو پشتیبانی نمی‌کند.\n      ")]):r("img",{staticClass:"discovery-product-card__media",attrs:{src:e.photo.MEDIUM,alt:e.name}}),e._v(" "),r("span",{staticClass:"discovery-product-card__price"},[e._v("\n        "+e._s(e.convertedPrice)+"\n        "),r("span",{staticClass:"bi bi-toman discovery-product-card__price-icon"})])],1),e._v(" "),r("ClientOnly",[r("BsDropdown",{staticClass:"discovery-product-card__dropdown",attrs:{icon:"bi-more",position:"bottom-right","modal-props":{title:"سایر گزینه‌ها",showClose:!0,lockScroll:!0}}},[e._t("actions",(function(){return[r("li",{on:{click:e.openShareModal}},[r("i",{staticClass:"bi bi-share"}),e._v(" "),r("span",[e._v("اشتراک گذاری")])]),e._v(" "),r("li",{on:{click:e.showReportModal}},[r("i",{staticClass:"bi bi-docs"}),e._v(" "),r("span",[e._v("گزارش خطا")])])]}))],2)],1),e._v(" "),r("Bookmark",{staticClass:"discovery-product-card__bookmark",attrs:{"product-id":+e.id,"listing-ids":e.listingIds}})],1),e._v(" "),r("a",{staticClass:"discovery-product-card__name",attrs:{href:e.link},on:{click:function(t){return t.preventDefault(),e.onMetroCardClick.apply(null,arguments)}}},[e._v("\n    "+e._s(e.name)+"\n  ")]),e._v(" "),e.isShareModalOpen?r("ShareModal",{attrs:{"shareable-data":e.productShareableData(e.productShareObject)},on:{close:e.closeShareModal}}):e._e()],1)}),[],!1,null,"1c125eb6",null),_=component.exports,k={name:"DiscoveryMetroCardSkeleton",components:{BsSkeleton:o.BsSkeleton}},P=(r(1225),{name:"DiscoveryMetroGrid",components:{DiscoveryMetroCard:_,DiscoveryMetroCardSkeleton:Object(m.a)(k,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"discovery-metro-card-skeleton"},[r("div",{staticClass:"discovery-metro-card-skeleton__image-box"},[r("BsSkeleton",{staticClass:"discovery-metro-card-skeleton__image",attrs:{width:"",height:""}})],1),e._v(" "),r("BsSkeleton",{staticClass:"discovery-metro-card-skeleton__name",attrs:{width:"",height:""}}),e._v(" "),r("BsSkeleton",{staticClass:"discovery-metro-card-skeleton__name",attrs:{width:"",height:""}})],1)}),[],!1,null,"dd156f94",null).exports},props:{products:{type:Array,default:function(){return[]}},skeleton:{type:[Object,Boolean],default:function(){return{show:!0,count:24}}},pageId:{type:String}},computed:{skeletonCount:function(){var e;return(null===(e=this.skeleton)||void 0===e?void 0:e.count)||24}},methods:{productCardProps:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id,type:"discovery",name:e.name,photo:e.photo,link:"/discovery/".concat(e.id),price:e.price,video:e.video_urls||{},vendor:e.vendor,pageId:this.pageId}}}}),C=P,S=(r(1226),Object(m.a)(C,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"discovery-metro-grid"},[e._l(e.products,(function(t){return r("DiscoveryMetroCard",e._b({key:t.id,staticClass:"discovery-metro-grid__product"},"DiscoveryMetroCard",e.productCardProps(t),!1))})),e._v(" "),e.skeleton||e.skeleton.show?e._l(e.skeletonCount,(function(e){return r("DiscoveryMetroCardSkeleton",{key:e,staticClass:"discovery-metro-grid__skeleton"})})):e._e()],2)}),[],!1,null,"1a519b04",null));t.a=S.exports},1360:function(e,t,r){e.exports={}},1686:function(e,t,r){"use strict";r(1360)},1992:function(e,t,r){"use strict";r.r(t);var n=r(36),o=r(0),c=(r(5),r(7),r(14),r(1249)),d={name:"DiscoveryPage",components:{InfinitePagination:r(338).a,DiscoveryMetroGrid:c.a},layout:"without-footer",middleware:["unauthorizedRedirectToAccounts"],data:function(){return{products:[],currentPage:1,totalPage:100,hasError:!1,showInfinite:!0,lastPageId:void 0,fetchProductLoading:!1}},head:function(){return{title:"بازارگردی"}},methods:{fetchInfiniteDiscoveryProducts:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchDiscoveryProducts();case 2:o=t.sent,c=o.products,d=o.pageId,e.sendDiscoveryViewLog({pageId:d,products:c,currentPage:e.currentPage}),(r=e.products).push.apply(r,Object(n.a)(c)),e.lastPageId=d;case 8:case"end":return t.stop()}}),t)})))()},fetchDiscoveryProducts:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,n,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.fetchProductLoading){t.next=2;break}return t.abrupt("return");case 2:return e.fetchProductLoading=!0,t.prev=3,t.next=6,e.$authGet("".concat(e.$config.discoveryUrl,"/api_v2.0/products?count=20"));case 6:if(n=t.sent,data=n.data,null!==(r=data.products)&&void 0!==r&&r.length){t.next=10;break}throw new Error("Something bad happened!");case 10:return t.abrupt("return",{products:data.products,pageId:data.page_id});case 13:return t.prev=13,t.t0=t.catch(3),e.$handleError(t.t0),e.hasError=!0,e.showInfinite=!1,t.abrupt("return",[]);case 19:return t.prev=19,e.fetchProductLoading=!1,t.finish(19);case 22:case"end":return t.stop()}}),t,null,[[3,13,19,22]])})))()},retry:function(){this.hasError=!1,this.showInfinite=!0},sendDiscoveryViewLog:function(e){var t=this,r=e.pageId,n=e.products,o=e.currentPage,c=[],d=[];n.forEach((function(e,r){c.push({id:e.id,price:e.price,rating:e.rating.average,primary_price:e.primaryPrice,label:e.label}),(t.products.length+r)%2!=0&&d.push(e.id)})),this.$publishEvent((function(e){return e.discovery_view}))({page_id:r,page:o,per_page:n.length,product_list:c,big_pic_products_list:d})},handleScroll:function(){if(this.$refs["bottom-navigation"]){var e=window.pageYOffset;this.$refs["bottom-navigation"].$el.style.bottom=this.prevScrollpos>e?"0":"-60px",this.prevScrollpos=e}}}},l=(r(1686),r(2)),component=Object(l.a)(d,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("section",{staticClass:"container discovery-page"},[r("DiscoveryMetroGrid",{attrs:{products:e.products,skeleton:{show:!0,count:e.$ua.isFromPc()?24:12}}}),e._v(" "),e.hasError?r("Retry",{staticClass:"discovery-page__retry",on:{retry:e.retry}}):e.showInfinite?r("InfinitePagination",{attrs:{mode:"infinite",page:e.currentPage,"total-page":e.totalPage,fetch:e.fetchInfiniteDiscoveryProducts,distance:2e3},on:{"update:page":function(t){e.currentPage=t}}}):e._e()],1)}),[],!1,null,"31ad2dc3",null);t.default=component.exports}}]);
//# sourceMappingURL=fcb084c.js.map