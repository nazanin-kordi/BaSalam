(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1215:function(t,e,r){"use strict";r.d(e,"c",(function(){return c})),r.d(e,"b",(function(){return o})),r.d(e,"a",(function(){return l}));r(5),r(38),r(56),r(34);var n=r(76);function c(t){var e;if(null==t||null===(e=t.errors)||void 0===e||!e.length)return!1;var r=[n.a.autoRefreshBasket.PRODUCT_IS_UNAVAILABLE_AND_ITEM_GOT_REMOVED,n.a.autoRefreshBasket.PRODUCT_OUT_OF_STOCK_AND_ITEM_GOT_REMOVED,n.a.autoRefreshBasket.VENDOR_IS_UNAVAILABLE_AND_ITEM_GOT_REMOVED];return t.errors.some((function(t){return r.includes(t.code)}))}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.reduce((function(t,e){return t.concat(e.items)}),[])}function l(t){return o(t).reduce((function(t,e){return t.concat(e.errors)}),[])}},1247:function(t,e,r){"use strict";r(8),r(9),r(10),r(7),r(11);var n=r(0),c=r(1),o=(r(14),r(34),r(38),r(56),r(6),r(5),r(81),r(32)),l=r(3),v=(r(43),r(46)),d={name:"CartInvoiceItem",props:{title:{type:String,default:""},price:{type:Number,default:0}},computed:{priceFormatted:function(){return isNaN(this.price)?this.price:Object(v.a)(this.price)}}},_=(r(1667),r(2)),h=Object(_.a)(d,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"cart-invoice__item"},[t._t("title",(function(){return[r("span",{domProps:{textContent:t._s(t.title)}})]})),t._v(" "),t._t("price",(function(){return[r("div",{staticClass:"cart-invoice__price"},[r("span",{domProps:{textContent:t._s(t.priceFormatted)}}),t._v(" "),r("i",{staticClass:"bi bi-toman icon-24"})])]}))],2)}),[],!1,null,"82a77b4a",null).exports,f=r(1585),m=(r(29),{name:"VpnHint",props:{isBox:{type:Boolean,default:!1}},data:function(){return{isConnectedToVpn:!1,requestTimeout:null}},computed:{isTrustGuaranteeShown:function(){return this.$isMobileScreen&&2===this.$cookies.get("exp-payment-trust-2")}},mounted:function(){this.checkVpnConnection(),document.addEventListener("visibilitychange",this.onVisibilityChange)},beforeDestroy:function(){clearTimeout(this.requestTimeout),document.removeEventListener("visibilitychange",this.onVisibilityChange)},methods:{checkVpnConnection:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(t.requestTimeout),e.next=3,t.$authGet("".concat(t.$config.featureFlagUrl,"/api_v2.0/geoip/in-ir"));case 3:r=e.sent,t.isConnectedToVpn=!r.data,t.isConnectedToVpn&&(t.requestTimeout=setTimeout(t.checkVpnConnection,2e4));case 6:case"end":return e.stop()}}),e)})))()},onVisibilityChange:function(){"visible"===document.visibilityState&&this.checkVpnConnection()}}}),y=(r(1669),Object(_.a)(m,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.isConnectedToVpn?r("div",{staticClass:"vpn-hint",class:{"vpn-hint--is-box":t.isBox,"vpn-hint--is-rtl":t.isTrustGuaranteeShown}},[r("i",{staticClass:"vpn-hint__icon bi-info icon-24"}),t._v(" "),r("span",[t._v("بهتره فیلتر شکن خود را خاموش کنید")])]):t._e()}),[],!1,null,"4f9432a5",null).exports);function C(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function O(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?C(Object(source),!0).forEach((function(e){Object(c.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):C(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var P={name:"CashBackHintCart",computed:O(O({},Object(o.mapGetters)("cart",["vendors","cashBackConfig"])),{},{endTime:function(){return this.cashBackConfig.endTime},cashBackAmount:function(){var t;return null===(t=this.cashBackConfig.amount)||void 0===t?void 0:t.totalRounded},cashBackAmountFormatted:function(){return Object(v.a)(this.cashBackAmount)},isShown:function(){return this.cashBackAmount>0}})},T=(r(1670),Object(_.a)(P,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.isShown?n("div",{staticClass:"cash-bak-hint"},[n("div",[n("img",{staticClass:"cash-bak-hint__image",attrs:{src:r(1343),alt:""}}),t._v(" "),n("span",[t._v("با خرید این محصولات،")]),t._v(" "),n("b",[t._v(t._s(t.cashBackAmountFormatted)+" تومن")]),t._v(" "),n("span",[t._v("هدیه میگیری!")])]),t._v(" "),n("div",{staticClass:"cash-bak-hint__counter"},[n("Countdown",{key:t.endTime,attrs:{until:t.endTime,"show-text":!1,"show-hour":"auto"}})],1)]):t._e()}),[],!1,null,"52699634",null).exports),S=r(1586),k=r(40),w=r(49),x=r(53),D=r(17),E=r(1215),I=r(62);function j(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(object);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,r)}return e}function B(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?j(Object(source),!0).forEach((function(e){Object(c.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):j(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var A={name:"CartInvoice",components:{VpnHint:y,Tooltip:f.a,BsButton:l.BsButton,CartInvoiceItem:h,CashBackHintCart:T,FinalPayablePrice:S.a},props:{activeTab:{type:String,required:!1,default:"firstCart"},type:{type:String,required:!1,default:"cart"},isDisabledNext:{type:Boolean,default:!1},showLotteryHint:{type:Boolean,default:!0}},data:function(){return{loading:!1,showCartError:!1}},computed:B(B(B({},Object(o.mapGetters)("cart",["items","credit","vendors","totalPrice","payableAmount","totalPrimaryPrice","totalDeliveryCost","lastAddToCartTime","cartItemHasMessage","payablePrimaryAmount","totalDeliveryDiscount","totalProductsDiscount","secondCartProductCount","hasIncompleteAddressError"])),Object(o.mapGetters)("auth",["isLoggedIn"])),{},{lotteryFeatureFlag:function(){return this.$getFeatureValue("lottery")},lotteryPurchaseAmount:function(){var t;return((null===(t=this.lotteryFeatureFlag)||void 0===t?void 0:t.purchase.amount)||2e5)/1e4},lotteryPriceWriting:function(){var t=this.lotteryPurchaseAmount*(this.calculatedLotteryScore+this.lotteryPurchaseScore)/this.lotteryPurchaseScore;if(t>=1e3){var a=Math.floor(t/1e3),b=t%1e3;return b?"".concat(a," میلیون و ").concat(b," هزارتومن"):"".concat(a," میلیون")}return"".concat(t," هزارتومن")},lotteryPurchaseScore:function(){var t;return(null===(t=this.lotteryFeatureFlag)||void 0===t?void 0:t.purchase.point)||2},showLotteryScores:function(){var t,e;return this.showLotteryHint&&(null===(t=this.lotteryFeatureFlag)||void 0===t||null===(e=t.purchase)||void 0===e?void 0:e.is_active)&&"firstCart"===this.activeTab&&this.$ua.isFromPc()},calculatedLotteryScore:function(){var t,e,r=(null===(t=this.lotteryFeatureFlag)||void 0===t||null===(e=t.purchase)||void 0===e?void 0:e.amount)||2e6;return Math.floor(this.totalPrice/r)*this.lotteryPurchaseScore},btnLabel:function(){return"shipping"===this.type?"ادامه و تایید روش ارسال":"payment"===this.type?"پرداخت":"تایید و ادامه"},showDeliveryTip:function(){var t=Object(w.d)().format("MM-DD");return"cart"===this.type&&"firstCart"===this.activeTab&&(t>"12-24"||t<"01-06")},displayPrice:function(){var t="cart"===this.type;return{total:t?this.totalPrice:this.payableAmount,primary:t?this.totalPrimaryPrice:this.payablePrimaryAmount}},cashBackConfig:function(){return this.$store.getters["cart/cashBackConfig"]},isCashBackShown:function(){var t;return null===(t=this.cashBackConfig)||void 0===t?void 0:t.isShown},cartInfoExperimentVariant:function(){var t;return this.isLoggedIn?null===(t=this.$runGBTest("test_cart_delivery_time_and_cost"))||void 0===t?void 0:t.value:"default"}}),watch:{cartItemHasMessage:function(t){t||(this.showCartError=!1)},lastAddToCartTime:function(t,e){null!==e&&this.sendCashBackEvent()}},mounted:function(){this.sendCashBackEvent()},methods:{goToNextPage:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.cartItemHasMessage){e.next=4;break}if(!t.$ua.isFromPc()){e.next=3;break}return e.abrupt("return",t.showCartError=!0);case 3:return e.abrupt("return",Object(k.a)({message:"محصولی در سبد خرید تغییر کرده است. برای ادامه وضعیت آن را مشخص کنید."}));case 4:if(t.isLoggedIn){e.next=6;break}return e.abrupt("return",t.$store.dispatch("authModal/showAuthModal",{redirectTo:"/cart/shipping"}));case 6:if("cart"!==t.type||!t.isBasketEmpty()){e.next=9;break}return Object(k.a)({message:"سبد خرید شما خالی است"}),e.abrupt("return",t.$emit("refresh"));case 9:if(e.t0="shipping"===t.type,!e.t0){e.next=14;break}return e.next=13,t.canContinue();case 13:e.t0=!e.sent;case 14:if(!e.t0){e.next=16;break}return e.abrupt("return");case 16:r=t.$route.path.includes("/cart/shipping"),t.$emit("go-next-page"),t.$router.push({path:r?"/cart/payment":"/cart/shipping"});case 19:case"end":return e.stop()}}),e)})))()},isBasketEmpty:function(){return 0===Object(E.b)(this.vendors).filter((function(t){return!Object(E.c)(t)})).length},canContinue:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,data,c,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,r=["ADDRESS_NOT_ATTACHED","ADDRESS_OUT_OF_SHIPPING_AREA","ORIGIN_HAS_NO_SHIPPING_METHODS","SHIPPING_METHOD_NOT_SUPPORTED_FOR_ADDRESS"],e.next=5,Object(I.r)(t.$orderRequest);case 5:return n=e.sent,data=n.data,c=Object(E.a)(data.vendors),(o=c.concat(data.errors).find((function(t){return r.includes(t.code)})))&&("ADDRESS_OUT_OF_SHIPPING_AREA"===o.code&&(o.message="تعدادی از محصولات قابل ارسال به آدرس انتخابی نیستند"),Object(k.a)({message:o.message})),e.abrupt("return",!o);case 13:return e.prev=13,e.t0=e.catch(0),Object(D.b)(e.t0),e.abrupt("return",!1);case 17:return e.prev=17,t.loading=!1,e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[0,13,17,20]])})))()},sendCashBackEvent:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(x.c)((function(){return t.cashBackConfig.loaded}));case 2:r=new Date-36e5,t.lastAddToCartTime&&t.lastAddToCartTime>r&&t.$evaluateGBTest("cash_back");case 4:case"end":return e.stop()}}),e)})))()},currencyFormat:v.a}},$=(r(1672),Object(_.a)(A,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",["firstCart"!==t.activeTab||t.$isMobileScreen?t._e():r("div",{staticClass:"cart-invoice"},[r("div",{staticClass:"cart-invoice__title"},[t._v("جزئیات قیمت")]),t._v(" "),r("CartInvoiceItem",{staticClass:"cart-invoice-primary-price",attrs:{title:"قیمت محصولات:",price:t.totalPrimaryPrice}}),t._v(" "),t.totalProductsDiscount>0?r("CartInvoiceItem",{staticClass:"cart-invoice-discount-price",attrs:{title:"(-) تخفیف محصولات:",price:t.totalProductsDiscount}}):t._e(),t._v(" "),r("hr"),t._v(" "),r("CartInvoiceItem",{staticClass:"cart-invoice-shipping-price",attrs:{title:"هزینه ارسال (از "+t.vendors.length+" غرفه)",price:t.totalDeliveryCost}},["shipping"!==t.type&&"payment"!==t.type&&"delivery_cost"!==t.cartInfoExperimentVariant&&"delivery_time_and_cost"!==t.cartInfoExperimentVariant?r("span",{attrs:{slot:"price"},slot:"price"},[t._v("\n        وابسته به آدرس\n      ")]):t.totalDeliveryDiscount===t.totalDeliveryCost?r("span",{staticClass:"cart-invoice-shipping-price--success",attrs:{slot:"price"},slot:"price"},[t._v("\n        رایگان\n      ")]):t._e()]),t._v(" "),"cart"==t.type&&"delivery_cost"!==t.cartInfoExperimentVariant&&"delivery_time_and_cost"!==t.cartInfoExperimentVariant||!t.totalDeliveryDiscount||t.totalDeliveryDiscount===t.totalDeliveryCost?t._e():r("CartInvoiceItem",{staticClass:"cart-invoice-discount-price",attrs:{title:"تخفیف هزینه ارسال:",price:t.totalDeliveryDiscount}}),t._v(" "),r("hr"),t._v(" "),"payment"===t.type?[t.credit?r("CartInvoiceItem",{staticClass:"cart-invoice-discount-price",attrs:{title:"(-) کسر از اعتبار:",price:t.credit}}):t._e(),t._v(" "),r("CartInvoiceItem",{staticClass:"cart-invoice-total-price",attrs:{title:"مبلغ قابل پرداخت",price:t.payableAmount}})]:"shipping"===t.type?r("CartInvoiceItem",{staticClass:"cart-invoice-total-price",attrs:{title:"مبلغ قابل پرداخت",price:t.payableAmount}}):t.totalPrice>0?r("CartInvoiceItem",{staticClass:"cart-invoice-total-price",attrs:{title:"مبلغ قابل پرداخت",price:t.totalPrice}}):t._e(),t._v(" "),t.isCashBackShown?r("CashBackHintCart",{staticClass:"cart-invoice__cash-back"}):t._e(),t._v(" "),t._t("button",(function(){return[r("BsButton",{attrs:{id:"cart-cta",size:"lg",label:t.btnLabel,loading:t.loading,"full-width":!0,disabled:t.isDisabledNext},on:{click:t.goToNextPage}})]})),t._v(" "),"payment"===t.type?r("div",{staticClass:"cart-invoice-subtitle--muted"},[r("span",[t._v("قابل پرداخت با تمامی کارت های عضو شتاب")])]):t._e(),t._v(" "),t._m(0),t._v(" "),t.showCartError?r("div",{staticClass:"text-danger pt-2"},[t._v("\n      محصولی در سبد خرید تغییر کرده است. برای ادامه وضعیت آن را مشخص کنید.\n    ")]):t._e()],2),t._v(" "),t.showDeliveryTip?r("div",{staticClass:"cart-delivery-tip"},[r("span",[t._v("از 25 اسفند تا 5 فروردین، به دلیل تعطیلات نوروزی و شلوغی پست")]),t._v(" "),r("span",[t._v("احتمال دارد سفارشتان")]),t._v(" "),r("b",[t._v("دیرتر به دستتان برسد.")])]):"payment"!==t.type||t.$isMobileScreen?t._e():r("VpnHint",{attrs:{"is-box":""}}),t._v(" "),t.showLotteryScores?r("div",{staticClass:"lottery"},[t._m(1),t._v(" "),0===t.calculatedLotteryScore?r("div",{staticClass:"lottery-content lottery__content"},[r("span",{staticClass:"lottery-content__title"},[t._v("\n        اگه سبد خریدت و هزینه ارسالش به "+t._s(t.lotteryPurchaseAmount)+" هزار تومن برسه\n        "+t._s(t.lotteryPurchaseScore)+" امتیاز می‌گیری!\n      ")])]):r("div",{staticClass:"lottery-content lottery__content"},[r("span",{staticClass:"lottery-content__title"},[t._v("\n        خریدتو نهایی کنی\n        "),r("b",[t._v(t._s(t.calculatedLotteryScore)+" امتیاز")]),t._v("\n        میگیری.\n      ")]),t._v(" "),r("span",{staticClass:"lottery-content__subtitle"},[t._v("\n        اگه سبد خریدت و هزینه ارسالش به "+t._s(t.lotteryPriceWriting)+" برسه\n        "+t._s(t.calculatedLotteryScore+t.lotteryPurchaseScore)+" امتیاز می‌گیری!\n      ")])]),t._v(" "),r("Tooltip",{staticClass:"lottery__tooltip",attrs:{position:"top left",text:"از باسلام خرید کن و ۴۰ میلیون تومن اعتبار خرید به قید قرعه مهمون باسلام باش."}})],1):t._e(),t._v(" "),"firstCart"===t.activeTab&&t.$isMobileScreen?r("div",{staticClass:"mobile-cart-invoice"},[t.isCashBackShown?r("CashBackHintCart"):t._e(),t._v(" "),t.showDeliveryTip?r("div",{staticClass:"cart-delivery-tip"},[r("span",[t._v("از 25 اسفند تا 5 فروردین، به دلیل تعطیلات نوروزی و شلوغی پست")]),t._v(" "),r("span",[t._v("احتمال دارد سفارشتان")]),t._v(" "),r("b",[t._v("دیرتر به دستتان برسد.")])]):"payment"===t.type?r("VpnHint"):t._e(),t._v(" "),t._t("button",(function(){return[r("div",{staticClass:"mobile-cart-invoice__buttons"},[r("BsButton",{attrs:{id:"cart-cta","full-width":!0,label:t.btnLabel,loading:t.loading,disabled:t.isDisabledNext},on:{click:t.goToNextPage}}),t._v(" "),r("FinalPayablePrice",{attrs:{"final-price":t.displayPrice.total}})],1)]}))],2):t._e(),t._v(" "),"firstCart"!==t.activeTab?r("div",{staticClass:"second-cart-info"},[r("div",{staticClass:"second-cart-info__title"},[t._v("سبد خرید بعدی چیست؟")]),t._v(" "),r("div",{staticClass:"second-cart-info__text"},[t._v("\n      شما می‌توانید محصولاتی که موقتا قصد خرید آن را ندارید به سبد خرید بعدی منتقل کنید و هر زمانی\n      که تمایل به خرید آن ها داشتید به سبد خرید خود اضافه کنید.\n    ")]),t._v(" "),t.secondCartProductCount>0?[r("div",{staticClass:"second-cart-info__line"}),t._v(" "),r("div",{staticClass:"second-cart-info__count"},[t._v("\n        "+t._s(t.secondCartProductCount)+" کالا در سبد خرید بعدی شماست\n      ")])]:t._e()],2):t._e()],1)}),[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"cart-invoice-subtitle"},[r("i",{staticClass:"bi bi-tick-circle icon-24"}),t._v(" "),r("span",[t._v("تسویه با غرفه‌دار فقط بعد از رضایت مشتری")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"lottery-score"},[e("div",{staticClass:"lottery-score__image-box"},[e("img",{staticClass:"lottery-score__image",attrs:{src:"https://statics.basalam.com/public/admin/bx3V8/07-02/IBKi8w8iKKzUU1A1T4QQ5iTvrpKL5GMPGp5XkKA3CyuULKEPLO.png",alt:""}})])])}],!1,null,"3836bdb6",null));e.a=$.exports},1340:function(t,e,r){t.exports={}},1341:function(t,e,r){t.exports={}},1342:function(t,e,r){t.exports={}},1343:function(t,e,r){t.exports=r.p+"img/cb-gift-xs.84cab1e.svg"},1344:function(t,e,r){t.exports={}},1345:function(t,e,r){t.exports={}},1346:function(t,e,r){t.exports={}},1585:function(t,e,r){"use strict";var n={name:"Tooltip",props:{slug:{type:String,reuquired:!0},text:{type:String,required:!0},icon:{type:String,required:!1},img:{type:String,required:!1},position:{type:String,required:!1,default:"top left"}},data:function(){return{isShow:!1}},mounted:function(){document.addEventListener("click",this.hideTooltip),2!=this.$cookies.get("tooltip-".concat(this.slug))&&(this.isShow=!0)},methods:{hideTooltip:function(){this.isShow=!1,this.removeTooltip(),this.$emit("hide")},removeTooltip:function(){this.isShow=!1,this.$cookies.set("tooltip-".concat(this.slug),2)}}},c=(r(1668),r(2)),component=Object(c.a)(n,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("Transition",{attrs:{name:"fade"}},[t.isShow?r("div",{class:["tooltip",t.position]},[t.img?r("img",{staticClass:"tooltip__image",attrs:{src:t.img}}):t.icon?r("i",{staticClass:"tooltip__icon",class:"bi bi-"+t.icon}):t._e(),t._v(" "),r("span",{staticClass:"tooltip__text"},[t._v(t._s(t.text))])]):t._e()])}),[],!1,null,"7ec6ef8d",null);e.a=component.exports},1586:function(t,e,r){"use strict";r(43);var n=r(46),c={name:"FinalPayablePrice",props:{finalPrice:{type:Number,default:0}},computed:{displayPrice:function(){return Object(n.a)(this.finalPrice)}}},o=(r(1671),r(2)),component=Object(o.a)(c,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"final-payable-price"},[r("span",[t._v("جمع سبد خرید:")]),t._v(" "),r("b",[t._v(t._s(t.displayPrice)+" تومان")])])}),[],!1,null,"429644a9",null);e.a=component.exports},1667:function(t,e,r){"use strict";r(1340)},1668:function(t,e,r){"use strict";r(1341)},1669:function(t,e,r){"use strict";r(1342)},1670:function(t,e,r){"use strict";r(1344)},1671:function(t,e,r){"use strict";r(1345)},1672:function(t,e,r){"use strict";r(1346)}}]);
//# sourceMappingURL=d0b1f40.js.map